<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Hub</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="desktop-ui-style.css">
    <!-- Socket.IO client -->
    <script src="/socket.io/socket.io.js"></script>
    <!-- Add electron-specific scripts only for desktop app -->
    <script>
        if (window.navigator.userAgent.toLowerCase().indexOf('electron') > -1) {
            const electronScript = document.createElement('script');
            electronScript.src = 'preload.js';
            document.head.appendChild(electronScript);
            
            const uiHelperScript = document.createElement('script');
            uiHelperScript.src = 'electron-ui-helper.js';
            document.head.appendChild(uiHelperScript);
        }
    </script>
    <script src="game-selection.js"></script>
</head>
<body>
    <div class="container">
        <h1>Game Hub</h1>
        
        <!-- Game type selection section -->
        <div id="game-type-selection" class="game-type-selection">
            <h2>Ch·ªçn lo·∫°i game</h2>
            <div class="game-types-container">
                <div class="game-type-card" id="caro-game-btn">
                    <div class="type-icon">‚ùå‚≠ï</div>
                    <h3>C·ªù Caro</h3>
                    <p>Tr√≤ ch∆°i x·∫øp 5 qu√¢n X ho·∫∑c O li√™n ti·∫øp tr√™n b√†n c·ªù</p>
                </div>
                
                <div class="game-type-card" id="animal-chess-btn">
                    <div class="type-icon">üêòüêÖ</div>
                    <h3>C·ªù Th√∫</h3>
                    <p>Tr√≤ ch∆°i c·ªù v·ªõi c√°c qu√¢n c·ªù l√† c√°c con v·∫≠t</p>
                </div>
            </div>
        </div>
        
        <!-- Game selection section (for Caro) -->
        <div id="game-selection" class="game-selection" style="display: none;">
            <h2>Ch·ªçn ch·∫ø ƒë·ªô ch∆°i</h2>
            <div class="game-modes-container">
                <div class="game-mode-card" id="local-game-btn">
                    <div class="mode-icon">üë•</div>
                    <h3>Ch∆°i t·∫°i ch·ªó</h3>
                    <p>Ch∆°i v·ªõi ng∆∞·ªùi kh√°c tr√™n c√πng thi·∫øt b·ªã</p>
                </div>
                
                <div class="game-mode-card" id="ai-game-btn">
                    <div class="mode-icon">ü§ñ</div>
                    <h3>Ch∆°i v·ªõi m√°y</h3>
                    <p>ƒê·∫•u v·ªõi AI ·ªü nhi·ªÅu c·∫•p ƒë·ªô kh√≥ kh√°c nhau</p>
                </div>
                
                <div class="game-mode-card" id="online-game-btn">
                    <div class="mode-icon">üåê</div>
                    <h3>Ch∆°i tr·ª±c tuy·∫øn</h3>
                    <p>Ch∆°i v·ªõi ng∆∞·ªùi kh√°c qua internet</p>
                </div>
                
                <div class="game-mode-card" id="ranked-game-btn">
                    <div class="mode-icon">üèÜ</div>
                    <h3>Ch∆°i x·∫øp h·∫°ng</h3>
                    <p>Tham gia c√°c tr·∫≠n ƒë·∫•u x·∫øp h·∫°ng v√† leo b·∫£ng x·∫øp h·∫°ng</p>
                </div>
            </div>
            
            <!-- Lu·∫≠t ch∆°i -->
            <div class="game-rules">
                <div class="rules-header" id="rules-toggle">
                    <h3>Lu·∫≠t ch∆°i</h3>
                    <span class="toggle-icon">‚ñº</span>
                </div>
                <div class="rules-content" id="rules-content">
                    <p><strong>Lu·∫≠t c∆° b·∫£n:</strong> Ng∆∞·ªùi ch∆°i thay phi√™n ƒë·∫∑t qu√¢n c·ªù c·ªßa m√¨nh (X ho·∫∑c O) v√†o c√°c √¥ tr·ªëng tr√™n b√†n c·ªù.</p>
                    <p><strong>ƒêi·ªÅu ki·ªán th·∫Øng:</strong> Ng∆∞·ªùi ch∆°i c√≥ 5 qu√¢n li√™n ti·∫øp theo chi·ªÅu ngang, d·ªçc ho·∫∑c ch√©o s·∫Ω th·∫Øng.</p>
                    <p><strong>Lu·∫≠t "ch·∫∑n 2 ƒë·∫ßu":</strong> M·ªôt chu·ªói 5 qu√¢n li√™n ti·∫øp ch·ªâ ƒë∆∞·ª£c t√≠nh l√† th·∫Øng n·∫øu kh√¥ng b·ªã ch·∫∑n c·∫£ hai ƒë·∫ßu b·ªüi qu√¢n c·ªßa ƒë·ªëi ph∆∞∆°ng ho·∫∑c bi√™n b√†n c·ªù. N·∫øu c·∫£ hai ƒë·∫ßu ƒë·ªÅu b·ªã ch·∫∑n, chu·ªói ƒë√≥ kh√¥ng ƒë∆∞·ª£c t√≠nh l√† th·∫Øng.</p>
                    <div class="rule-example">
                        <p><strong>V√≠ d·ª•:</strong></p>
                        <p>‚úì XXXXX (Th·∫Øng: kh√¥ng b·ªã ch·∫∑n)</p>
                        <p>‚úì OXXXXXX (Th·∫Øng: ch·ªâ b·ªã ch·∫∑n 1 ƒë·∫ßu)</p>
                        <p>‚úì XXXXXO (Th·∫Øng: ch·ªâ b·ªã ch·∫∑n 1 ƒë·∫ßu)</p>
                        <p>‚úó OXXXXO (Kh√¥ng th·∫Øng: b·ªã ch·∫∑n c·∫£ 2 ƒë·∫ßu)</p>
                    </div>
                </div>
            </div>
            
            <!-- Back button -->
            <div class="back-to-selection">
                <button id="back-to-game-types-btn" class="back-btn">Quay l·∫°i</button>
            </div>
        </div>
        
        <!-- Animal Chess Game Selection -->
        <div id="animal-chess-selection" class="game-selection" style="display: none;">
            <h2>C·ªù Th√∫ - Ch·ªçn ch·∫ø ƒë·ªô ch∆°i</h2>
            <div class="game-modes-container">
                <div class="game-mode-card" id="animal-local-game-btn">
                    <div class="mode-icon">üë•</div>
                    <h3>Ch∆°i t·∫°i ch·ªó</h3>
                    <p>Ch∆°i v·ªõi ng∆∞·ªùi kh√°c tr√™n c√πng thi·∫øt b·ªã</p>
                </div>
                
                <div class="game-mode-card" id="animal-ai-game-btn">
                    <div class="mode-icon">ü§ñ</div>
                    <h3>Ch∆°i v·ªõi m√°y</h3>
                    <p>ƒê·∫•u v·ªõi AI ·ªü nhi·ªÅu c·∫•p ƒë·ªô kh√≥ kh√°c nhau</p>
                </div>
                
                <div class="game-mode-card" id="animal-online-game-btn">
                    <div class="mode-icon">üåê</div>
                    <h3>Ch∆°i tr·ª±c tuy·∫øn</h3>
                    <p>Ch∆°i v·ªõi ng∆∞·ªùi kh√°c qua internet</p>
                </div>
            </div>
            
            <!-- Lu·∫≠t ch∆°i c·ªù th√∫ -->
            <div class="game-rules">
                <div class="rules-header" id="animal-rules-toggle">
                    <h3>Lu·∫≠t ch∆°i</h3>
                    <span class="toggle-icon">‚ñº</span>
                </div>
                <div class="rules-content" id="animal-rules-content">
                    <p><strong>Lu·∫≠t c∆° b·∫£n:</strong> C·ªù th√∫ l√† tr√≤ ch∆°i chi·∫øn thu·∫≠t gi·ªØa hai ng∆∞·ªùi ch∆°i tr√™n b√†n c·ªù 7x9.</p>
                    <p><strong>M·ª•c ti√™u:</strong> ƒê∆∞a m·ªôt trong c√°c con th√∫ c·ªßa b·∫°n v√†o hang (ƒë·ªÅn) c·ªßa ƒë·ªëi ph∆∞∆°ng ho·∫∑c b·∫Øt h·∫øt c√°c con th√∫ c·ªßa ƒë·ªëi ph∆∞∆°ng.</p>
                    <p><strong>Th·ª© b·∫≠c qu√¢n c·ªù:</strong> Voi > S∆∞ t·ª≠ > C·ªçp > B√°o > Ch√≥ > S√≥i > M√®o > Chu·ªôt. Chu·ªôt c√≥ th·ªÉ b·∫Øt Voi.</p>
                </div>
            </div>
            
            <!-- Back button -->
            <div class="back-to-selection">
                <button id="animal-back-to-game-types-btn" class="back-btn">Quay l·∫°i</button>
            </div>
        </div>
        
        <!-- Local/AI Game settings -->
        <div id="local-settings" class="settings" style="display: none;">
            <div class="board-size">
                <label for="board-size-select">K√≠ch th∆∞·ªõc b√†n c·ªù:</label>
                <select id="board-size-select">
                    <option value="10">10x10</option>
                    <option value="15" selected>15x15</option>
                    <option value="20">20x20</option>
                    <option value="custom">T√πy ch·ªânh</option>
                </select>
            </div>
            
            <!-- T√πy ch·ªânh k√≠ch th∆∞·ªõc b√†n c·ªù -->
            <div class="custom-board-size" id="custom-board-size-container" style="display: none;">
                <div class="custom-size-input">
                    <label for="custom-size">S·ªë √¥ (5-30):</label>
                    <input type="number" id="custom-size" min="5" max="30" value="15">
                </div>
                <div class="size-note">L∆∞u √Ω: K√≠ch th∆∞·ªõc qu√° l·ªõn c√≥ th·ªÉ ·∫£nh h∆∞·ªüng ƒë·∫øn hi·ªáu su·∫•t.</div>
            </div>
            
            <div class="game-mode">
                <label for="game-mode-select">Ch·∫ø ƒë·ªô ch∆°i:</label>
                <select id="game-mode-select">
                    <option value="human">Ch∆°i v·ªõi ng∆∞·ªùi</option>
                    <option value="ai">Ch∆°i v·ªõi m√°y</option>
                </select>
            </div>
            <div class="ai-difficulty" id="ai-difficulty-container" style="display: none;">
                <label for="ai-difficulty-select">ƒê·ªô kh√≥:</label>
                <select id="ai-difficulty-select">
                    <option value="easy">D·ªÖ</option>
                    <option value="medium" selected>Trung b√¨nh</option>
                    <option value="hard">Kh√≥</option>
                    <option value="veryhard">R·∫•t kh√≥</option>
                </select>
            </div>
            <button id="start-local-game-btn" class="start-btn">B·∫Øt ƒë·∫ßu</button>
        </div>
        
        <!-- Ranked Game settings -->
        <div id="ranked-settings" class="settings" style="display: none;">
            <div id="ranked-login" class="online-section">
                <input type="text" id="ranked-player-name" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n" maxlength="15">
                <input type="password" id="ranked-player-password" placeholder="M·∫≠t kh·∫©u" maxlength="20">
                <div class="ranked-buttons">
                    <button id="ranked-login-btn" class="online-btn">ƒêƒÉng nh·∫≠p</button>
                    <button id="ranked-register-btn" class="online-btn">ƒêƒÉng k√Ω</button>
                </div>
                <div class="back-to-selection">
                    <button id="ranked-back-btn" class="online-btn back-btn">Quay l·∫°i</button>
                </div>
            </div>
            
            <div id="ranked-lobby" class="online-section" style="display: none;">
                <div class="player-info">
                    <div class="ranked-player-info">
                        <span>Xin ch√†o, </span><span id="ranked-current-player"></span>
                        <div class="ranked-stats">
                            <div class="rank-badge" id="rank-badge">
                                <span id="player-rank">B·∫°c</span>
                            </div>
                            <div class="elo-info">
                                <span>ƒêi·ªÉm Elo: </span><span id="player-elo">1000</span>
                            </div>
                        </div>
                        <button id="ranked-logout-btn" class="logout-btn">ƒêƒÉng xu·∫•t</button>
                    </div>
                </div>
                
                <!-- B·∫£ng x·∫øp h·∫°ng -->
                <div class="leaderboard-section">
                    <div class="leaderboard-header">
                        <h3>B·∫£ng x·∫øp h·∫°ng</h3>
                        <button id="refresh-leaderboard-btn" class="refresh-btn">L√†m m·ªõi</button>
                    </div>
                    <div id="leaderboard-container" class="leaderboard-container">
                        <div class="loading-leaderboard">ƒêang t·∫£i b·∫£ng x·∫øp h·∫°ng...</div>
                    </div>
                </div>
                
                <div class="ranked-options">
                    <button id="find-match-btn" class="online-btn">T√¨m tr·∫≠n ƒë·∫•u</button>
                    <div id="finding-match" class="finding-match" style="display: none;">
                        <div class="finding-text">ƒêang t√¨m ƒë·ªëi th·ªß...</div>
                        <div class="spinner"></div>
                        <button id="cancel-match-btn" class="cancel-btn">H·ªßy</button>
                    </div>
                </div>
                
                <div class="ranked-buttons-row">
                    <button id="ranked-info-btn" class="online-btn">Th√¥ng tin h·∫°ng</button>
                    <button id="ranked-rooms-btn" class="online-btn">Danh s√°ch ph√≤ng</button>
                    <button id="ranked-back-to-menu-btn" class="online-btn back-btn">Quay l·∫°i</button>
                </div>
            </div>
            
            <!-- Danh s√°ch ph√≤ng x·∫øp h·∫°ng -->
            <div id="ranked-room-section" class="online-section" style="display: none;">
                <div class="player-info">
                    <div class="ranked-player-info">
                        <span>Xin ch√†o, </span><span id="ranked-current-player-room"></span>
                        <div class="ranked-stats">
                            <div class="rank-badge" id="rank-badge-room">
                                <span id="player-rank-room">B·∫°c</span>
                            </div>
                            <div class="elo-info">
                                <span>ƒêi·ªÉm Elo: </span><span id="player-elo-room">1000</span>
                            </div>
                        </div>
                        <button id="ranked-logout-btn-room" class="logout-btn">ƒêƒÉng xu·∫•t</button>
                    </div>
                </div>
                
                <!-- Danh s√°ch ph√≤ng -->
                <div class="room-list-section">
                    <div class="room-list-header">
                        <h3>Danh s√°ch ph√≤ng</h3>
                        <button id="refresh-ranked-rooms-btn" class="refresh-btn">L√†m m·ªõi</button>
                    </div>
                    <div id="ranked-room-list-container" class="room-list-container">
                        <div class="loading-rooms">ƒêang t·∫£i danh s√°ch ph√≤ng...</div>
                    </div>
                </div>
                
                <div class="or-divider">ho·∫∑c</div>
                
                <div class="room-options">
                    <button id="create-ranked-room-btn" class="online-btn">T·∫°o ph√≤ng m·ªõi</button>
                    <div class="or-divider">ho·∫∑c</div>
                    <div class="join-room">
                        <input type="text" id="ranked-room-id-input" placeholder="Nh·∫≠p m√£ ph√≤ng">
                        <button id="join-ranked-room-btn" class="online-btn">V√†o ph√≤ng</button>
                    </div>
                </div>
                
                <div class="back-to-lobby">
                    <button id="back-to-ranked-lobby-btn" class="online-btn">Quay l·∫°i</button>
                </div>
            </div>
            
            <div id="ranked-match-info" class="online-section" style="display: none;">
                <div class="match-info">
                    <h3>Th√¥ng tin tr·∫≠n ƒë·∫•u</h3>
                    <div class="players-status">
                        <div id="ranked-player1-status" class="player-status">
                            <span class="player-label">X: </span>
                            <span id="ranked-player1-name">ƒêang ch·ªù...</span>
                            <span class="player-elo" id="ranked-player1-elo">(1000)</span>
                        </div>
                        <div id="ranked-player2-status" class="player-status">
                            <span class="player-label">O: </span>
                            <span id="ranked-player2-name">ƒêang ch·ªù...</span>
                            <span class="player-elo" id="ranked-player2-elo">(1000)</span>
                        </div>
                    </div>
                </div>
                <button id="leave-ranked-match-btn" class="online-btn">R·ªùi tr·∫≠n ƒë·∫•u</button>
            </div>
            
            <!-- K·∫øt qu·∫£ tr·∫≠n ƒë·∫•u -->
            <div id="match-result" class="match-result" style="display: none;">
                <div class="result-header">
                    <h3>K·∫øt qu·∫£ tr·∫≠n ƒë·∫•u</h3>
                </div>
                <div class="result-content">
                    <div class="result-status" id="result-status">Th·∫Øng!</div>
                    <div class="elo-change">
                        <span>ƒêi·ªÉm Elo: </span>
                        <span id="old-elo">1000</span>
                        <span> ‚Üí </span>
                        <span id="new-elo">1020</span>
                        <span id="elo-diff" class="elo-diff">(+20)</span>
                    </div>
                </div>
                <button id="close-result-btn" class="online-btn">ƒê√≥ng</button>
            </div>
        </div>
        
        <!-- Game board section -->
        <div id="game-board-container" class="game-container" style="display: none;">
            <div class="status" id="status">L∆∞·ª£t c·ªßa X</div>
            <div class="zoom-controls">
                <button class="zoom-btn" id="zoom-out">-</button>
                <input type="range" min="50" max="300" value="100" class="zoom-slider" id="zoom-slider">
                <button class="zoom-btn" id="zoom-in">+</button>
                <span class="zoom-value" id="zoom-value">100%</span>
                <button class="zoom-btn reset-position-btn" id="reset-position" title="ƒê·∫∑t l·∫°i v·ªã tr√≠ b√†n c·ªù">‚ü≤</button>
            </div>
            <div class="board-container" id="board-container">
                <div class="board-wrapper" id="board-wrapper">
                    <div class="board" id="board">
                        <!-- Game board will be generated by JavaScript -->
                    </div>
                </div>
            </div>
            <div class="game-controls">
                <button id="reset-btn">Ch∆°i l·∫°i</button>
                <button id="back-btn">Quay l·∫°i</button>
            </div>
        </div>
    </div>
    
    <!-- Server info section -->
    <div class="server-info">
        <button class="server-info-toggle" id="server-info-toggle" title="Thu g·ªçn/M·ªü r·ªông">‚àí</button>
        <p>Server: <span id="server-url">localhost:3000</span></p>
        <p>IP LAN: <span id="lan-ip">ƒêang t·∫£i...</span></p>
        <p>Ng∆∞·ªùi ch∆°i: <span id="online-players">0</span></p>
        <p>Ph√≤ng: <span id="active-rooms">0</span></p>
    </div>
    
    <!-- Game scripts -->
    <script src="socket-client.js"></script>
    <script src="ranked-game.js"></script>
    <script src="script.js"></script>
    
    <!-- Script c·∫≠p nh·∫≠t th√¥ng tin server -->
    <script>
        // H√†m c·∫≠p nh·∫≠t tr·ª±c ti·∫øp th√¥ng tin server
        function updateServerInfo() {
            // C·∫≠p nh·∫≠t IP LAN
            const lanIpElement = document.getElementById('lan-ip');
            if (lanIpElement) {
                // Th·ª≠ l·∫•y t·ª´ localStorage
                const savedIp = localStorage.getItem('lan-ip');
                if (savedIp) {
                    lanIpElement.textContent = savedIp;
                } else {
                    lanIpElement.textContent = 'ƒêang c·∫≠p nh·∫≠t...';
                    // N·∫øu kh√¥ng c√≥ trong localStorage, thi·∫øt l·∫≠p gi√° tr·ªã m·∫∑c ƒë·ªãnh
                    fetch('/get-lan-ip')
                        .then(response => response.text())
                        .then(ip => {
                            lanIpElement.textContent = ip;
                            localStorage.setItem('lan-ip', ip);
                        })
                        .catch(() => {
                            lanIpElement.textContent = window.location.hostname;
                        });
                }
            }
            
            // C·∫≠p nh·∫≠t th√¥ng tin ng∆∞·ªùi ch∆°i v√† ph√≤ng
            const playersElement = document.getElementById('online-players');
            const roomsElement = document.getElementById('active-rooms');
            
            // L·∫•y th√¥ng tin th·ª±c t·∫ø t·ª´ server
            fetch('/get-server-stats')
                .then(response => response.json())
                .then(stats => {
                    if (playersElement) playersElement.textContent = stats.players;
                    if (roomsElement) roomsElement.textContent = stats.rooms;
                })
                .catch(err => {
                    console.error('L·ªói khi l·∫•y th√¥ng tin server:', err);
                });
            
            // C·∫≠p nh·∫≠t l·∫°i sau 5 gi√¢y
            setTimeout(updateServerInfo, 5000);
        }
        
        // G·ªçi h√†m c·∫≠p nh·∫≠t ngay khi t·∫£i trang
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(updateServerInfo, 500);
        });
    </script>
</body>
</html> 